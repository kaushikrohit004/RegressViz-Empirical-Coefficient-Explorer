<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BetaVisualizer • RegrCoeffsExplorer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BetaVisualizer">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RegrCoeffsExplorer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.0000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/BetaVisualizer.html">BetaVisualizer</a></li>
    <li><a class="dropdown-item" href="../articles/OddsRatioVisualizer.html">OddsRatioVisualizer</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>BetaVisualizer</h1>
                        <h4 data-toc-skip class="author">Vadim
Tyuryaev<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;York University,Mathematics and Statistic, &lt;a href="mailto:vadimtyu@yorku.ca" class="email"&gt;vadimtyu@yorku.ca&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>
</h4>
                        <h4 data-toc-skip class="author">Aleksandr
Tsybakin<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;York University,Mathematics and Statistic, &lt;a href="mailto:tsybakin@yorku.ca" class="email"&gt;tsybakin@yorku.ca&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a>
</h4>
                        <h4 data-toc-skip class="author">Jane
Heffernan<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;York University,Mathematics and Statistic, &lt;a href="mailto:jmheffer@yorku.ca" class="email"&gt;jmheffer@yorku.ca&lt;/a&gt;&lt;/p&gt;'><sup>3</sup></a>
</h4>
                        <h4 data-toc-skip class="author">Hanna
Jankowski<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;York University,Mathematics and Statistic, &lt;a href="mailto:hkj@yorku.ca" class="email"&gt;hkj@yorku.ca&lt;/a&gt;&lt;/p&gt;'><sup>4</sup></a>
</h4>
                        <h4 data-toc-skip class="author">Kevin
McGregor<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;York University,Mathematics and Statistic, &lt;a href="mailto:kevinmcg@yorku.ca" class="email"&gt;kevinmcg@yorku.ca&lt;/a&gt;&lt;/p&gt;'><sup>5</sup></a>
</h4>
            
      

      <div class="d-none name"><code>BetaVisualizer.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="libraries">LIBRARIES<a class="anchor" aria-label="anchor" href="#libraries"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vadimtyuryaev.github.io/RegrCoeffsExplorer/">RegrCoeffsExplorer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu" class="external-link">glmnet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">selectiveInference</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/julianfaraway/faraway" class="external-link">faraway</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://personality-project.org/r/psych/" class="external-link">psych</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">EXAMPLES<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="lm-object">1. LM object<a class="anchor" aria-label="anchor" href="#lm-object"></a>
</h3>
<div class="section level4">
<h4 id="data">1.1 Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h4>
<p>To assess the impact of automobile design and performance
characteristics on fuel efficiency, measured in miles per gallon
(<code>MPG</code>), we apply our data visualization tool to the
<code>mtcars</code> dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># help(mtcars)</span></span>
<span></span>
<span><span class="va">df_mtcars</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>,<span class="st">"vs"</span>,<span class="st">"am"</span>,<span class="st">"gear"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df_mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>,<span class="st">"vs"</span>,<span class="st">"am"</span>,<span class="st">"gear"</span><span class="op">)</span><span class="op">]</span> , <span class="va">factor</span><span class="op">)</span> <span class="co"># convert to factor</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_mtcars</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span>
<span><span class="co">#&gt; Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></span>
<span></span>
<span><span class="va">lm_object</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">~</span><span class="va">cyl</span><span class="op">+</span><span class="va">hp</span><span class="op">+</span><span class="va">wt</span><span class="op">+</span><span class="va">disp</span><span class="op">+</span><span class="va">vs</span><span class="op">+</span><span class="va">am</span><span class="op">+</span><span class="va">carb</span>,data<span class="op">=</span><span class="va">df_mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_object</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = mpg ~ cyl + hp + wt + disp + vs + am + carb, data = df_mtcars)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -3.8806 -1.1961 -0.2563  1.2542  4.6905 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 31.96076    3.66507   8.720 9.47e-09 ***</span></span>
<span><span class="co">#&gt; cyl6        -2.57040    1.79214  -1.434   0.1650    </span></span>
<span><span class="co">#&gt; cyl8         0.20422    3.73915   0.055   0.9569    </span></span>
<span><span class="co">#&gt; hp          -0.04911    0.02456  -2.000   0.0575 .  </span></span>
<span><span class="co">#&gt; wt          -3.16405    1.42802  -2.216   0.0369 *  </span></span>
<span><span class="co">#&gt; disp         0.01032    0.01570   0.657   0.5176    </span></span>
<span><span class="co">#&gt; vs1          2.53765    1.97564   1.284   0.2118    </span></span>
<span><span class="co">#&gt; am1          2.44093    1.68650   1.447   0.1613    </span></span>
<span><span class="co">#&gt; carb         0.53464    0.76313   0.701   0.4906    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 2.468 on 23 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.8756, Adjusted R-squared:  0.8323 </span></span>
<span><span class="co">#&gt; F-statistic: 20.23 on 8 and 23 DF,  p-value: 1.105e-08</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="default-side-by-side-plots">1.2 Default side-by-side plots<a class="anchor" aria-label="anchor" href="#default-side-by-side-plots"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span><span class="va">lm_object</span><span class="op">)</span><span class="op">$</span><span class="st">"SidebySide"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-4-1.png" width="1152"></p>
<p>It is imperative to acknowledge that variables such as engine
configuration (specifically, the straight engine <code>vs1</code>) and
vehicle <code>weight</code> influence fuel efficiency the most, with the
effect of <code>vs</code> variable remaining consistent when examining
changes in coefficients of continuous variables occurring within
empirical data spanning from the first (Q1) to the third (Q3) quartiles
by default. Nonetheless, a paradigm shift is observed for several other
variables when the analysis transitions from a per-unit change
perspective (as depicted in the left plot) to an examination of
variations between the Q1 and Q3 quartiles (illustrated in the right
plot). Under this new analytical lens, <code>displacement</code> and
<code>horsepower</code> emerge as the third positive and first negative
most influential factors, respectively. This shift in variable
significance can be attributed to the fact that the differences in
displacement and horsepower among the majority of vehicles do not
typically equate to a mere 1 cubic inch or 1 horsepower. Consequently,
this phenomenon underscores the criticality of considering the
distribution of variables in the interpretation of regression outcomes,
as reliance on per-unit interpretations may lead to misconceptions.</p>
</div>
<div class="section level4">
<h4 id="visualizing-per-unit-change-together-with-an-intercept">1.3 Visualizing per-unit change together with an intercept<a class="anchor" aria-label="anchor" href="#visualizing-per-unit-change-together-with-an-intercept"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span><span class="va">lm_object</span>, intercept<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="st">"PerUnitVis"</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="adding-confidence-intervals-cis">1.4 Adding Confidence Intervals (CIs)<a class="anchor" aria-label="anchor" href="#adding-confidence-intervals-cis"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span><span class="va">lm_object</span>, intercept<span class="op">=</span><span class="cn">T</span>, CI<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="st">"PerUnitVis"</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="customizing-pallete-title-and-modifying-default-realized-effect-size-calculations">1.4 Customizing pallete, title, and modifying default realized
effect size calculations<a class="anchor" aria-label="anchor" href="#customizing-pallete-title-and-modifying-default-realized-effect-size-calculations"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span></span>
<span>             <span class="va">lm_object</span>, CI<span class="op">=</span><span class="cn">T</span>,palette<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"palegreen4"</span>,<span class="st">"tomato1"</span><span class="op">)</span>,</span>
<span>             eff_size_diff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>             title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>               <span class="st">"Regression - Unit Change"</span>, </span>
<span>               <span class="st">"Regression - Effective Change (min --&gt; max)"</span></span>
<span>                     <span class="op">)</span></span>
<span>                     <span class="op">)</span><span class="op">$</span><span class="st">"SidebySide"</span></span>
<span>             <span class="op">)</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-7-1.png" width="1152"></p>
</div>
<div class="section level4">
<h4 id="customizing-individual-graphs">1.5 Customizing individual graphs<a class="anchor" aria-label="anchor" href="#customizing-individual-graphs"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># obtain coefficients for vs and wt</span></span>
<span><span class="va">vline1</span><span class="op">=</span><span class="va">lm_object</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">'vs1'</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">vline2</span><span class="op">=</span><span class="va">lm_object</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">'wt'</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span><span class="va">lm_object</span><span class="op">)</span><span class="op">$</span><span class="st">"PerUnitVis"</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="va">vline1</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>   <span class="co"># add a vertical line</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="va">vline2</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"orange"</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Visualization of Regression Results (per unit change)"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span><span class="op">+</span>                                                                 <span class="co"># note the coordinate flip</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"aspects"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"coefficients"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"pink"</span> <span class="op">)</span><span class="op">)</span><span class="op">+</span>                             <span class="co"># change mappings </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>                               <span class="co"># place title in the center</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="glm-object">2. GLM object<a class="anchor" aria-label="anchor" href="#glm-object"></a>
</h3>
<p>We employ the High School and Beyond dataset (<code>hsb</code>) to
visualize the odds of selecting the <code>Academic</code> high school
program. This analysis is based on predictors such as sex, race,
socioeconomic status and scores on several subjects.</p>
<div class="section level4">
<h4 id="data-and-fitted-object">2.1 Data and fitted object<a class="anchor" aria-label="anchor" href="#data-and-fitted-object"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># ?hsb</span></span>
<span></span>
<span><span class="va">glm_object</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">prog</span> <span class="op">==</span> <span class="st">"academic"</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span><span class="va">math</span><span class="op">+</span> <span class="va">read</span> <span class="op">+</span> <span class="va">write</span> <span class="op">+</span> <span class="va">science</span> <span class="op">+</span> <span class="va">socst</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>, </span>
<span>  data <span class="op">=</span> <span class="fu">faraway</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/faraway/man/hsb.html" class="external-link">hsb</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">glm_object</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = I(prog == "academic") ~ gender + math + read + </span></span>
<span><span class="co">#&gt;     write + science + socst, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = faraway::hsb)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) -7.86563    1.33027  -5.913 3.36e-09 ***</span></span>
<span><span class="co">#&gt; gendermale   0.25675    0.37566   0.683 0.494314    </span></span>
<span><span class="co">#&gt; math         0.10454    0.02996   3.490 0.000484 ***</span></span>
<span><span class="co">#&gt; read         0.03869    0.02618   1.478 0.139455    </span></span>
<span><span class="co">#&gt; write        0.03794    0.02767   1.371 0.170272    </span></span>
<span><span class="co">#&gt; science     -0.08102    0.02676  -3.028 0.002460 ** </span></span>
<span><span class="co">#&gt; socst        0.04908    0.02260   2.172 0.029860 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 276.76  on 199  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 208.87  on 193  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 222.87</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="default-side-by-side-plots-cis-and-99-confidence-interval">2.2 Default side-by-side plots, CIs and 99% confidence interval<a class="anchor" aria-label="anchor" href="#default-side-by-side-plots-cis-and-99-confidence-interval"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span></span>
<span>             <span class="va">glm_object</span>,</span>
<span>             CI<span class="op">=</span><span class="cn">T</span>, </span>
<span>             alpha<span class="op">=</span><span class="fl">0.01</span></span>
<span>                    <span class="op">)</span><span class="op">$</span><span class="st">"SidebySide"</span></span>
<span>             <span class="op">)</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-10-1.png" width="1152"></p>
<p>Upon examination of the regression coefficients derived from the
empirical data distribution for a change between Q1 and Q3 for
continuous independent variables, it is evident that the
<code>math</code> score variable exerts the highest impact on the odds
of selecting an academic program as shown on the right plot.
Concurrently, the variable <code>gendermale</code> which predominates in
influence as depicted in the left plot, transitions to the position of
minimal positive impact within this context.</p>
</div>
</div>
<div class="section level3">
<h3 id="glmnet-model-objects">3 GLMNET model objects<a class="anchor" aria-label="anchor" href="#glmnet-model-objects"></a>
</h3>
<div class="section level4">
<h4 id="data-1">3.1. Data<a class="anchor" aria-label="anchor" href="#data-1"></a>
</h4>
<p>We utilize the LASSO regression to understand how various car
characteristics influence sales price using a data set from 93 Cars on
Sale in the USA in 1993.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df_glmnet</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Cars93</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_glmnet</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df_glmnet</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span>, <span class="op">]</span> <span class="co"># examine 5 randomly selected rows</span></span>
<span><span class="co">#&gt;    Manufacturer      Model    Type Min.Price Price Max.Price MPG.city</span></span>
<span><span class="co">#&gt; 45      Hyundai    Elantra   Small       9.0  10.0      11.0       22</span></span>
<span><span class="co">#&gt; 23        Dodge       Colt   Small       7.9   9.2      10.6       29</span></span>
<span><span class="co">#&gt; 76      Pontiac Grand_Prix Midsize      15.4  18.5      21.6       19</span></span>
<span><span class="co">#&gt; 63   Mitsubishi   Diamante Midsize      22.4  26.1      29.9       18</span></span>
<span><span class="co">#&gt; 47      Hyundai     Sonata Midsize      12.4  13.9      15.3       20</span></span>
<span><span class="co">#&gt;    MPG.highway     AirBags DriveTrain Cylinders EngineSize Horsepower  RPM</span></span>
<span><span class="co">#&gt; 45          29        None      Front         4        1.8        124 6000</span></span>
<span><span class="co">#&gt; 23          33        None      Front         4        1.5         92 6000</span></span>
<span><span class="co">#&gt; 76          27        None      Front         6        3.4        200 5000</span></span>
<span><span class="co">#&gt; 63          24 Driver only      Front         6        3.0        202 6000</span></span>
<span><span class="co">#&gt; 47          27        None      Front         4        2.0        128 6000</span></span>
<span><span class="co">#&gt;    Rev.per.mile Man.trans.avail Fuel.tank.capacity Passengers Length Wheelbase</span></span>
<span><span class="co">#&gt; 45         2745             Yes               13.7          5    172        98</span></span>
<span><span class="co">#&gt; 23         3285             Yes               13.2          5    174        98</span></span>
<span><span class="co">#&gt; 76         1890             Yes               16.5          5    195       108</span></span>
<span><span class="co">#&gt; 63         2210              No               19.0          5    190       107</span></span>
<span><span class="co">#&gt; 47         2335             Yes               17.2          5    184       104</span></span>
<span><span class="co">#&gt;    Width Turn.circle Rear.seat.room Luggage.room Weight  Origin</span></span>
<span><span class="co">#&gt; 45    66          36           28.0           12   2620 non-USA</span></span>
<span><span class="co">#&gt; 23    66          32           26.5           11   2270     USA</span></span>
<span><span class="co">#&gt; 76    72          41           28.5           16   3450     USA</span></span>
<span><span class="co">#&gt; 63    70          43           27.5           14   3730 non-USA</span></span>
<span><span class="co">#&gt; 47    69          41           31.0           14   2885 non-USA</span></span>
<span><span class="co">#&gt;                   Make</span></span>
<span><span class="co">#&gt; 45     Hyundai Elantra</span></span>
<span><span class="co">#&gt; 23          Dodge Colt</span></span>
<span><span class="co">#&gt; 76  Pontiac Grand_Prix</span></span>
<span><span class="co">#&gt; 63 Mitsubishi Diamante</span></span>
<span><span class="co">#&gt; 47      Hyundai Sonata</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df_glmnet</span><span class="op">$</span><span class="va">Origin</span><span class="op">)</span>                                                        <span class="co"># check level attributes</span></span>
<span><span class="co">#&gt; [1] "USA"     "non-USA"</span></span>
<span></span>
<span><span class="va">df_glmnet</span><span class="op">=</span><span class="va">df_glmnet</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>MPG.avg <span class="op">=</span> <span class="op">(</span><span class="va">MPG.city</span> <span class="op">+</span> <span class="va">MPG.highway</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>          <span class="co"># calculate average MPG</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="lasso---data-preparation-and-model">3.2 LASSO - data preparation and model<a class="anchor" aria-label="anchor" href="#lasso---data-preparation-and-model"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">y_lasso</span><span class="op">=</span><span class="va">df_glmnet</span><span class="op">$</span><span class="va">Price</span></span>
<span></span>
<span><span class="va">x_lasso</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"~"</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MPG.avg"</span>,<span class="st">"Horsepower"</span>,<span class="st">"RPM"</span>,<span class="st">"Wheelbase"</span>, </span>
<span>                                 <span class="st">"Passengers"</span>,<span class="st">"Length"</span>, <span class="st">"Width"</span>, <span class="st">"Weight"</span>,</span>
<span>                                 <span class="st">"Origin"</span>,<span class="st">"Man.trans.avail"</span></span>
<span>                                 <span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"+"</span></span>
<span>                               <span class="op">)</span>,sep <span class="op">=</span> <span class="st">""</span></span>
<span>                         <span class="op">)</span></span>
<span>                   <span class="op">)</span>, data<span class="op">=</span><span class="va">df_glmnet</span></span>
<span>                     <span class="op">)</span></span>
<span>                                                   </span>
<span></span>
<span><span class="va">x_lasso</span> <span class="op">=</span> <span class="va">x_lasso</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>                                                         <span class="co"># remove intercept</span></span>
<span></span>
<span><span class="va">ndim_lasso</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x_lasso</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">cv_model_lasso</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">x_lasso</span>, <span class="va">y_lasso</span>, family<span class="op">=</span><span class="st">"gaussian"</span>, alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span>        <span class="co"># LASSO regression</span></span>
<span></span>
<span><span class="co"># extract value of lambda that gives minimum mean cross-validated error</span></span>
<span><span class="va">best_lambda_lasso</span> <span class="op">=</span> <span class="va">cv_model_lasso</span><span class="op">$</span><span class="va">lambda.min</span>                                   </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/intervals/man/plot.Intervals.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv_model_lasso</span><span class="op">)</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">best_model_lasso</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span><span class="va">x_lasso</span>, <span class="va">y_lasso</span>, family<span class="op">=</span><span class="st">"gaussian"</span>, alpha<span class="op">=</span><span class="fl">1</span>, </span>
<span>                            lambda<span class="op">=</span><span class="va">best_lambda_lasso</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coefficients</a></span><span class="op">(</span><span class="va">best_model_lasso</span><span class="op">)</span></span>
<span><span class="co">#&gt; 11 x 1 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#&gt;                             s0</span></span>
<span><span class="co">#&gt; (Intercept)        41.95022623</span></span>
<span><span class="co">#&gt; MPG.avg            -0.22248811</span></span>
<span><span class="co">#&gt; Horsepower          0.14052097</span></span>
<span><span class="co">#&gt; RPM                -0.00231447</span></span>
<span><span class="co">#&gt; Wheelbase           0.49693874</span></span>
<span><span class="co">#&gt; Passengers         -1.24284515</span></span>
<span><span class="co">#&gt; Length              0.07883149</span></span>
<span><span class="co">#&gt; Width              -1.22607113</span></span>
<span><span class="co">#&gt; Weight              .         </span></span>
<span><span class="co">#&gt; Originnon-USA       3.50458209</span></span>
<span><span class="co">#&gt; Man.trans.availYes -1.70340278</span></span></code></pre></div>
<p>Note that on Lasso regression plots two values of regularization
parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
are indicated:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{min}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mn>1</mn><mi>s</mi><mi>e</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{1se}</annotation></semantics></math>.
What is the difference? The first,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{min}</annotation></semantics></math>is
the value that minimizes the cross-validated error, leading to a model
that fits the data with the lowest prediction error, but with a
potential risk of overfitting.
Conversely,<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mn>1</mn><mi>s</mi><mi>e</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{1se}</annotation></semantics></math>.
is a more conservative choice, representing the largest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
within one standard error of the minimum error, resulting in a simpler,
more robust model that is less likely to overfit while maintaining a
prediction error close to the minimum. For our analysis we select
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{min}</annotation></semantics></math>.</p>
<p>The LASSO regression has reduced the coefficient for the
<code>weight</code> variable to zero, likely due to its high correlation
with other variables included in the analysis.</p>
</div>
<div class="section level4">
<h4 id="checking-correlations-for-numeric-variables-of-interest">3.3 Checking correlations for numeric variables of interest<a class="anchor" aria-label="anchor" href="#checking-correlations-for-numeric-variables-of-interest"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df_glmnet_num</span><span class="op">=</span><span class="va">df_glmnet</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_if</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>                  </span>
<span></span>
<span><span class="va">cols_to_select</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MPG.avg"</span>,<span class="st">"Horsepower"</span>,<span class="st">"RPM"</span>,<span class="st">"Wheelbase"</span>,<span class="st">"Passengers"</span>,</span>
<span>                   <span class="st">"Length"</span>, <span class="st">"Width"</span>, <span class="st">"Weight"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_glmnet_num</span><span class="op">=</span><span class="va">df_glmnet_num</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">cols_to_select</span><span class="op">)</span><span class="op">)</span>                 </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/cor.plot.html" class="external-link">corPlot</a></span><span class="op">(</span><span class="va">df_glmnet_num</span>,xlas<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
<p>The correlation matrix substantiates our hypothesis, revealing a high
correlation between weight and multiple variables incorporated in the
model.</p>
</div>
<div class="section level4">
<h4 id="default-lasso-plots-with-custom-realized-effect-size">3.4 Default LASSO plots with custom realized effect size<a class="anchor" aria-label="anchor" href="#default-lasso-plots-with-custom-realized-effect-size"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span><span class="va">best_model_lasso</span>,eff_size_diff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,         <span class="co"># Q2 - minimum</span></span>
<span>                     glmnet_fct_var<span class="op">=</span><span class="st">"Originnon-USA"</span><span class="op">)</span><span class="op">$</span><span class="st">"SidebySide"</span><span class="op">)</span>  <span class="co"># note the naming pattern for categorical variables</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-14-1.png" width="1152"></p>
<p>Note that the <code>Weight</code> variable is retained and remains
consistently equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
across both plots. Additionally, the variation in regression
coefficients and their interpretation align with the paradigm change
discussed previously.</p>
</div>
<div class="section level4">
<h4 id="modifying-idividial-plots-and-arraning-them-back-together">3.5 Modifying idividial plots and arraning them back together<a class="anchor" aria-label="anchor" href="#modifying-idividial-plots-and-arraning-them-back-together"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">plt_1</span><span class="op">=</span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span><span class="va">best_model_lasso</span>,eff_size_diff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>              glmnet_fct_var<span class="op">=</span><span class="st">"Originnon-USA"</span><span class="op">)</span><span class="op">$</span><span class="st">"PerUnitVis"</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Visualization of CV.GLMNET Results (per unit change)"</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Car characteristics"</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"LASSO coefficients"</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"whitesmoke"</span> <span class="op">)</span><span class="op">)</span><span class="op">+</span>                            </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>   </span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span>
<span></span>
<span><span class="va">plt_2</span><span class="op">=</span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span><span class="va">best_model_lasso</span>, eff_size_diff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>              glmnet_fct_var<span class="op">=</span><span class="st">"Originnon-USA"</span><span class="op">)</span><span class="op">$</span><span class="st">"RealizedEffectVis"</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Visualization of CV.GLMNET Results (effective:min --&gt; Q2)"</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>,<span class="fl">15</span><span class="op">)</span><span class="op">+</span>        </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Car characteristics"</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"LASSO coefficients"</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"maroon1"</span>,<span class="st">"palegreen1"</span> <span class="op">)</span><span class="op">)</span><span class="op">+</span>                            </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>   </span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">fill</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">fill</span>, which will replace the existing scale.</span></span>
<span></span>
<span><span class="va">plt_3</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">arrangeGrob</a></span><span class="op">(</span><span class="va">plt_1</span>,<span class="va">plt_2</span>, nrow<span class="op">=</span><span class="fl">1</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">plt_3</span><span class="op">)</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-15-1.png" width="1152"></p>
<p>Note that coefficients with absolute values exceeding those specified
in the <code>ylim</code> vector will not be visualized. For instance,
setting <code>ylim</code>=c(-2,2) for the left plot would result in the
omission of the <code>Originnon-USA</code> coefficient from the
visualization.</p>
</div>
<div class="section level4">
<h4 id="post-selection-inference">3.6 Post Selection Inference<a class="anchor" aria-label="anchor" href="#post-selection-inference"></a>
</h4>
</div>
<div class="section level4">
<h4 id="data-2">3.6.1 Data<a class="anchor" aria-label="anchor" href="#data-2"></a>
</h4>
<p>We employ the Stanford Heart Transplant data (<code>jasa</code>)
which bcontains detailed records of heart transplant patients, including
their survival times, status, and other clinical variables, used for
survival analysis to demonstrate the construction of CIs for
<code>glmnet</code> type objects.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># ?jasa</span></span>
<span></span>
<span><span class="va">heart_df</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/heart.html" class="external-link">jasa</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">heart_df_filtered</span> <span class="op">=</span> <span class="va">heart_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>                      <span class="co"># remove rows containing NaN values</span></span>
<span></span>
<span><span class="co"># check last 6 rows of the data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">)</span></span>
<span><span class="co">#&gt;       birth.dt  accept.dt    tx.date    fu.date fustat surgery      age futime</span></span>
<span><span class="co">#&gt; 93  1925-10-10 1973-07-11 1973-08-07 1974-04-01      0       0 47.75086    264</span></span>
<span><span class="co">#&gt; 94  1929-11-11 1973-09-14 1973-09-17 1974-02-25      1       1 43.84120    164</span></span>
<span><span class="co">#&gt; 96  1947-02-09 1973-10-04 1973-10-16 1974-04-01      0       0 26.65024    179</span></span>
<span><span class="co">#&gt; 97  1950-04-11 1973-11-22 1973-12-12 1974-04-01      0       0 23.61670    130</span></span>
<span><span class="co">#&gt; 98  1945-04-28 1973-12-14 1974-03-19 1974-04-01      0       0 28.62971    108</span></span>
<span><span class="co">#&gt; 100 1939-01-31 1974-02-22 1974-03-31 1974-04-01      0       1 35.06092     38</span></span>
<span><span class="co">#&gt;     wait.time transplant mismatch hla.a2 mscore reject</span></span>
<span><span class="co">#&gt; 93         27          1        2      0   0.33      0</span></span>
<span><span class="co">#&gt; 94          3          1        3      0   1.20      1</span></span>
<span><span class="co">#&gt; 96         12          1        2      0   0.46      0</span></span>
<span><span class="co">#&gt; 97         20          1        3      1   1.78      0</span></span>
<span><span class="co">#&gt; 98         95          1        4      1   0.77      0</span></span>
<span><span class="co">#&gt; 100        37          1        3      0   0.67      0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="data-observations">3.6.2 Data observations<a class="anchor" aria-label="anchor" href="#data-observations"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># filtered data only contains patients who received a transplant,</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">transplant</span><span class="op">!=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># mismatch scores are weakly correlated,</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">'Correlation between mismatch scores:'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Correlation between mismatch scores:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">mscore</span>,<span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">mismatch</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3881104</span></span>
<span></span>
<span><span class="co"># if rejection occurs, the death is certain, at least, in this data set</span></span>
<span><span class="va">heart_cont_table</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">reject</span>,<span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">fustat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">heart_cont_table</span><span class="op">)</span> <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Reject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No"</span>, <span class="st">"Yes"</span><span class="op">)</span>, </span>
<span>  Status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Alive"</span>, <span class="st">"Deceased"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">heart_cont_table</span></span>
<span><span class="co">#&gt;       Status</span></span>
<span><span class="co">#&gt; Reject Alive Deceased</span></span>
<span><span class="co">#&gt;    No     24       12</span></span>
<span><span class="co">#&gt;    Yes     0       29</span></span>
<span>                       </span>
<span><span class="co"># 'age' is skewed variable with a very big range</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Range of '\ age \' variable is : "</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Range of ' age ' variable is :  44.8569472963724"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">age</span>, main<span class="op">=</span><span class="st">"Histogram of Age"</span>, xlab<span class="op">=</span><span class="st">"age"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">age</span>,main<span class="op">=</span><span class="st">"Boxplot of Age"</span>, ylab<span class="op">=</span><span class="st">"age"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>,main<span class="op">=</span><span class="st">"Histogram of transformed data"</span>, xlab<span class="op">=</span><span class="st">"Sqrt(age)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>,main<span class="op">=</span><span class="st">"Boxplot of transformed data"</span>, ylab<span class="op">=</span><span class="st">"Sqrt(age)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-17-1.png" width="1152"></p>
</div>
<div class="section level4">
<h4 id="a-note-about-rounding">3.6.3 A note about rounding<a class="anchor" aria-label="anchor" href="#a-note-about-rounding"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># observe that age variable is not rounded</span></span>
<span></span>
<span><span class="co"># it is calculated in the following manner</span></span>
<span><span class="va">age_calc_example</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">accept.dt</span>, </span>
<span>                          <span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">birth.dt</span>,units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">/</span><span class="fl">365.25</span></span>
<span></span>
<span><span class="co"># check the first calculated value</span></span>
<span><span class="va">age_calc_example</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="va">heart_df_filtered</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">$</span><span class="va">age</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># check randomly selected value</span></span>
<span><span class="va">n_samp</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">age_calc_example</span><span class="op">[</span><span class="va">n_samp</span><span class="op">]</span><span class="op">==</span><span class="va">heart_df_filtered</span><span class="op">[</span><span class="va">n_samp</span>,<span class="op">]</span><span class="op">$</span><span class="va">age</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># check 5 point summary </span></span>
<span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">age</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   19.55   42.50   48.02   46.03   52.08   64.41</span></span>
<span></span>
<span><span class="co"># check 5 point summary for data rounded down to the nearest integer</span></span>
<span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">age</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   19.00   42.00   48.00   45.54   52.00   64.00</span></span></code></pre></div>
<p>In the realm of our visualization tool, two primary inquiries
emerge:</p>
<p>*How does the Odds Ratio (OR) change with a <strong>unit
increment</strong> in the variables under scrutiny?</p>
<p>*How does the OR vary in response to alterations <em>exceeding a
single unit</em>, such as the disparity between the first (Q1) and third
(Q3) quartiles within the data distribution?</p>
<p>It is crucial to acknowledge that the data distribution may not
always support a per-unit interpretation, as exemplified by the
<code>age</code> variable within our dataset. Consequently, when
engaging in calculations that encompass changes across quartiles, it is
advisable to employ rounding strategies (either floor or ceiling
functions) prior to data input. This approach facilitates the comparison
of ORs associated with unit age discrepancies (e.g., 1 year) against
those pertaining to more substantial differences (e.g., 10 years).</p>
<p>Absence of rounding can lead to nuanced interpretations. Consider,
for instance, the interquartile range for the <code>age</code> variable,
which is calculated as Q3 - Q1 (52.08 - 42.50 = 9.58 years). In such
scenarios, the OR derived from the Q3 to Q1 variation in
<code>age</code> essentially compares the odds of mortality among
individuals with an age gap of 9.58 years, a differential that may not
intuitively serve as the most illustrative measure. In the
<code><a href="../reference/vis_reg.html">vis_reg()</a></code> function, the <code>round_func</code> parameter
allows for the specification of rounding the calculated differences
either upwards or downwards to the nearest integer, thus providing a
more instinctual explication.</p>
</div>
<div class="section level4">
<h4 id="model">3.6.4 Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># reject categorical variable in not included due to the reason previously stated</span></span>
<span><span class="va">heart_df_filtered</span> <span class="op">=</span> <span class="va">heart_df_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"surgery"</span><span class="op">)</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply 'sqrt()' transformation to 'age' variable</span></span>
<span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">sqrt.age</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y_heart</span><span class="op">=</span><span class="va">heart_df_filtered</span><span class="op">$</span><span class="va">fustat</span></span>
<span></span>
<span><span class="va">x_heart</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"~"</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sqrt.age"</span> ,<span class="st">"mismatch"</span>,<span class="st">"mscore"</span>, <span class="st">"surgery"</span><span class="op">)</span>,collapse <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span>,</span>
<span>         sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">heart_df_filtered</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_heart</span><span class="op">=</span><span class="va">x_heart</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">x_heart_orig</span><span class="op">=</span><span class="va">x_heart</span>                                                            <span class="co"># save original data set</span></span>
<span><span class="va">x_heart</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x_heart</span>,<span class="cn">T</span>,<span class="cn">T</span><span class="op">)</span>                                                    </span>
<span></span>
<span><span class="va">gfit_heart</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">x_heart</span>,<span class="va">y_heart</span>,standardize<span class="op">=</span><span class="cn">F</span>,family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lambda_heart</span><span class="op">=</span><span class="va">gfit_heart</span><span class="op">$</span><span class="va">lambda.min</span></span>
<span><span class="va">n_heart</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x_heart</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="va">beta_hat_heart</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">gfit_heart</span>, x<span class="op">=</span><span class="va">x_heart</span>, y<span class="op">=</span><span class="va">y_heart</span>, s<span class="op">=</span><span class="va">lambda_heart</span>, exact<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note that lambda should be multiplied by the number of rows</span></span>
<span><span class="va">out_heart</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/selectiveInference/man/fixedLassoInf.html" class="external-link">fixedLassoInf</a></span><span class="op">(</span><span class="va">x_heart</span>,<span class="va">y_heart</span>,<span class="va">beta_hat_heart</span>,<span class="va">lambda_heart</span><span class="op">*</span><span class="va">n_heart</span>,</span>
<span>                          family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="co">#check the output</span></span>
<span><span class="va">out_heart</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; fixedLassoInf(x = x_heart, y = y_heart, beta = beta_hat_heart, </span></span>
<span><span class="co">#&gt;     lambda = lambda_heart * n_heart, family = "binomial")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Testing results at lambda = 1.336, with alpha = 0.100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Var   Coef Z-score P-value LowConfPt UpConfPt LowTailArea UpTailArea</span></span>
<span><span class="co">#&gt;    1  0.811   2.738   0.009     0.269    1.302       0.048      0.049</span></span>
<span><span class="co">#&gt;    2 -0.514  -1.681   0.172    -1.008    0.415       0.050      0.049</span></span>
<span><span class="co">#&gt;    3  0.497   1.487   0.232    -0.624    1.033       0.049      0.049</span></span>
<span><span class="co">#&gt;    4 -0.430  -1.605   0.149    -0.867    0.276       0.050      0.050</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note: coefficients shown are full regression coefficients</span></span>
<span></span>
<span><span class="co"># note the class</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">out_heart</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "fixedLogitLassoInf"</span></span></code></pre></div>
<p>Although the data input is centered and scaled, the coefficients and
CIs are presented on the original scale. The package includes a function
named <code>detransform</code> that carries out the re-scaling and
de-centering process for effective size difference calculations.
Alternatively, consider rounding down or up before passing the data to
the function.</p>
</div>
<div class="section level4">
<h4 id="a-note-on-data-scaling-and-centering-in-relation-to-glmnet-objects">3.6.5 A note on data scaling and centering in relation to
<code>glmnet</code> objects<a class="anchor" aria-label="anchor" href="#a-note-on-data-scaling-and-centering-in-relation-to-glmnet-objects"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span><span class="co"># back transformation logic</span></span>
<span> <span class="va">x_heart_reconstructed</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x_heart</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span>   <span class="va">x</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x_heart</span>,<span class="st">'scaled:scale'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x_heart</span>, <span class="st">'scaled:center'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span> <span class="co"># check</span></span>
<span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x_heart_orig</span>,<span class="va">x_heart_reconstructed</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span> </span>
<span> <span class="co"># same via a function</span></span>
<span> <span class="va">x_heart_reconstructed.2</span><span class="op">=</span><span class="fu"><a href="../reference/detransform.html">detransform</a></span><span class="op">(</span><span class="va">x_heart</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x_heart_orig</span>,<span class="va">x_heart_reconstructed.2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="lasso-regression-with-cis-and-custom-realized-effect-size">3.6.6 LASSO regression with CIs and custom realized effect size<a class="anchor" aria-label="anchor" href="#lasso-regression-with-cis-and-custom-realized-effect-size"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span><span class="va">out_heart</span>, CI<span class="op">=</span><span class="cn">T</span>, glmnet_fct_var<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"surgery1"</span><span class="op">)</span>, </span>
<span>                     round_func<span class="op">=</span><span class="st">"none"</span>,eff_size_diff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="st">"SidebySide"</span></span>
<span>             <span class="op">)</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-21-1.png" width="1152"></p>
</div>
<div class="section level4">
<h4 id="a-note-on-selective-inference">3.6.7 A note on Selective Inference<a class="anchor" aria-label="anchor" href="#a-note-on-selective-inference"></a>
</h4>
<p>In the domain of Selective Inference, it is noteworthy that CIs may
not encompass the estimated coefficients. To elucidate, scenarios may
arise wherein both bounds of the confidence intervals are positioned
beneath the estimated coefficients. The following example is reproduced
without any changes from <strong>“Tools for Post-Selection
Inference”</strong> (pp.9-10).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">43</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="va">sigma</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>,<span class="va">n</span>,<span class="va">p</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">p</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">x</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">beta</span> <span class="op">+</span> <span class="va">sigma</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">pf</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">7</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="co">#define penalty factors</span></span>
<span><span class="va">pf</span><span class="op">=</span><span class="va">p</span><span class="op">*</span><span class="va">pf</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pf</span><span class="op">)</span> <span class="co"># penalty factors should be rescaled so they sum to p</span></span>
<span><span class="va">xs</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span>,<span class="cn">FALSE</span>,<span class="va">pf</span><span class="op">)</span> <span class="co">#scale cols of x by penalty factors</span></span>
<span><span class="co"># first run glmnet</span></span>
<span><span class="va">gfit</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span><span class="va">xs</span>, <span class="va">y</span>, standardize<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># extract coef for a given lambda; note the 1/n factor!</span></span>
<span><span class="co"># (and we don't save the intercept term)</span></span>
<span><span class="va">lambda</span> <span class="op">=</span> <span class="fl">.8</span></span>
<span><span class="va">beta_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">gfit</span>, x<span class="op">=</span><span class="va">xs</span>, y<span class="op">=</span><span class="va">y</span>, s<span class="op">=</span><span class="va">lambda</span><span class="op">/</span><span class="va">n</span>, exact<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># compute fixed lambda p-values and selection intervals</span></span>
<span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/selectiveInference/man/fixedLassoInf.html" class="external-link">fixedLassoInf</a></span><span class="op">(</span><span class="va">xs</span>,<span class="va">y</span>,<span class="va">beta_hat</span>,<span class="va">lambda</span>,sigma<span class="op">=</span><span class="va">sigma</span><span class="op">)</span></span>
<span><span class="co">#rescale conf points to undo the penalty factor</span></span>
<span><span class="va">out</span><span class="op">$</span><span class="va">ci</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">ci</span><span class="op">)</span>,<span class="cn">FALSE</span>,<span class="va">pf</span><span class="op">[</span><span class="va">out</span><span class="op">$</span><span class="va">vars</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">out</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; fixedLassoInf(x = xs, y = y, beta = beta_hat, lambda = lambda, </span></span>
<span><span class="co">#&gt;     sigma = sigma)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Standard deviation of noise (specified or estimated) sigma = 1.000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Testing results at lambda = 0.800, with alpha = 0.100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Var   Coef Z-score P-value LowConfPt UpConfPt LowTailArea UpTailArea</span></span>
<span><span class="co">#&gt;    1  3.987  18.880   0.000     2.657    3.229       0.049      0.050</span></span>
<span><span class="co">#&gt;    2  2.911  13.765   0.000     1.454    2.364       0.050      0.049</span></span>
<span><span class="co">#&gt;    3  0.187   0.776   0.303    -0.747    1.671       0.050      0.050</span></span>
<span><span class="co">#&gt;    4  0.149   0.695   0.625    -1.040    0.353       0.050      0.049</span></span>
<span><span class="co">#&gt;    5 -0.294  -1.221   0.743    -0.379    2.681       0.050      0.050</span></span>
<span><span class="co">#&gt;    6 -0.206  -0.978   0.685    -0.349    1.568       0.049      0.050</span></span>
<span><span class="co">#&gt;    7  0.195   0.914   0.407    -0.487    0.401       0.049      0.049</span></span>
<span><span class="co">#&gt;    8  0.006   0.295   0.758    -1.711    0.363       0.050      0.049</span></span>
<span><span class="co">#&gt;    9 -0.015  -0.723   0.458    -0.368    0.531       0.050      0.050</span></span>
<span><span class="co">#&gt;   10 -0.003  -0.157   0.948    -0.011    7.828       0.050      0.050</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note: coefficients shown are partial regression coefficients</span></span></code></pre></div>
<p>Note that confidence intervals for the first two variables contain
the <strong>true</strong> values <code>c(3,2)</code> and <strong>do not
encompass</strong> the estimated coefficients
<code>c(3.987,2.911)</code>.</p>
</div>
<div class="section level4">
<h4 id="glmnet-with-penalty-factor-and-cis">3.6.7 GLMNET with penalty factor and CIs<a class="anchor" aria-label="anchor" href="#glmnet-with-penalty-factor-and-cis"></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pf_heart</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">p_l</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pf_heart</span><span class="op">)</span></span>
<span><span class="va">pf_heart</span><span class="op">=</span><span class="va">p_l</span><span class="op">*</span><span class="va">pf_heart</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pf_heart</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xs_heart_res</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x_heart</span>,<span class="cn">FALSE</span>,<span class="va">pf_heart</span><span class="op">)</span>                                      <span class="co"># note that the data is being scaled again</span></span>
<span></span>
<span><span class="va">gfit_heart_pef_fac_res</span> <span class="op">=</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">cv.glmnet</a></span><span class="op">(</span><span class="va">xs_heart_res</span>, <span class="va">y_heart</span>, standardize<span class="op">=</span><span class="cn">FALSE</span>, </span>
<span>                                   family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lambda_heart_pef_fac_res</span><span class="op">=</span><span class="va">gfit_heart_pef_fac_res</span><span class="op">$</span><span class="va">lambda.min</span></span>
<span></span>
<span><span class="va">beta_hat_heart_res</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">gfit_heart_pef_fac_res</span>, x<span class="op">=</span><span class="va">xs_heart_res</span>, y<span class="op">=</span><span class="va">y_heart</span>,</span>
<span>                        s<span class="op">=</span><span class="va">lambda_heart_pef_fac_res</span>, exact<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_heart_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/selectiveInference/man/fixedLassoInf.html" class="external-link">fixedLassoInf</a></span><span class="op">(</span><span class="va">xs_heart_res</span>,<span class="va">y_heart</span>,<span class="va">beta_hat_heart_res</span>,</span>
<span>                              <span class="va">lambda_heart_pef_fac_res</span><span class="op">*</span><span class="va">n_heart</span>,family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_heart_res</span><span class="op">$</span><span class="va">ci</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">out_heart_res</span><span class="op">$</span><span class="va">ci</span><span class="op">)</span>,<span class="cn">FALSE</span>,<span class="va">pf_heart</span><span class="op">[</span><span class="va">out_heart_res</span><span class="op">$</span><span class="va">vars</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out_heart_res</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; fixedLassoInf(x = xs_heart_res, y = y_heart, beta = beta_hat_heart_res, </span></span>
<span><span class="co">#&gt;     lambda = lambda_heart_pef_fac_res * n_heart, family = "binomial")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Testing results at lambda = 0.877, with alpha = 0.100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Var   Coef Z-score P-value LowConfPt UpConfPt LowTailArea UpTailArea</span></span>
<span><span class="co">#&gt;    1  1.630   2.774   0.009     0.273    1.304       0.050      0.048</span></span>
<span><span class="co">#&gt;    2 -0.351  -1.690   0.121    -1.038    0.244       0.049      0.049</span></span>
<span><span class="co">#&gt;    3  0.342   1.491   0.167    -0.397    1.078       0.049      0.049</span></span>
<span><span class="co">#&gt;    4 -0.291  -1.608   0.127    -0.884    0.219       0.049      0.050</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note: coefficients shown are full regression coefficients</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="a-second-note-on-data-scaling-and-centering-in-relation-to-fixedlassoinf-objects">3.6.8 A second note on data scaling and centering in relation to
<code>fixedLassoInf</code> objects<a class="anchor" aria-label="anchor" href="#a-second-note-on-data-scaling-and-centering-in-relation-to-fixedlassoinf-objects"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">x_heart_test_3</span><span class="op">=</span><span class="fu"><a href="../reference/detransform.html">detransform</a></span><span class="op">(</span><span class="va">xs_heart_res</span>, attr_center<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_heart_test_3</span><span class="op">=</span><span class="fu"><a href="../reference/detransform.html">detransform</a></span><span class="op">(</span><span class="va">x_heart_test_3</span>,</span>
<span>                           attr_scale<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x_heart</span>, <span class="st">'scaled:scale'</span><span class="op">)</span>,</span>
<span>                           attr_center<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x_heart</span>, <span class="st">'scaled:center'</span><span class="op">)</span></span>
<span>                           <span class="op">)</span></span>
<span><span class="co"># check</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x_heart_test_3</span>,<span class="va">x_heart_orig</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The <strong>vis_reg()</strong> function operates by extracting the
necessary information from the provided object. However, in the context
of generating CIS with penalty factors for <code>fixedLassoInf</code>
type objects, a dual transformation, as illustrated previously, is
necessary. Direct reconstruction from the passed object is not possible
in such instances. Therefore, to obtain CIs for
<code>fixedLassoInf</code> objects that have been fitted using penalty
factors, it is essential to supply the original, non-transformed
data.</p>
</div>
<div class="section level4">
<h4 id="post-selection-inference-with-cis-and-penalty-factors">3.6.9 Post selection inference with CIs and penalty factors<a class="anchor" aria-label="anchor" href="#post-selection-inference-with-cis-and-penalty-factors"></a>
</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># note that case_penalty=T and x_data_orig must be specified</span></span>
<span></span>
<span><span class="co"># effective change between Q1(2) and max(5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="fu"><a href="../reference/vis_reg.html">vis_reg</a></span><span class="op">(</span><span class="va">out_heart_res</span>, CI<span class="op">=</span><span class="cn">T</span>, glmnet_fct_var<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"surgery1"</span><span class="op">)</span>, </span>
<span>                     case_penalty<span class="op">=</span><span class="cn">T</span>, x_data_orig<span class="op">=</span><span class="va">x_heart_orig</span>,</span>
<span>                     eff_size_diff<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="st">"SidebySide"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BetaVisualizer_files/figure-html/unnamed-chunk-25-1.png" width="1152"></p>
<p>It is important to observe that when the computed effective size
difference is below 1, such would have been the case if we utilized
default Q3 - Q1 difference which is 7.217 - 6.519 = 0.698 ( see
<code>summary(heart_df_filtered$sqrt.age)</code> ), the OR on the right
plot would correspond to a change of <strong>less</strong> than one
unit. As a result, the numerical values presented on the right plot
would be lower than those on the left plot. This outcome may appear
counter intuitive at first glance.</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vadim Tyuryaev, Aleksandr Tsybakin, Jane Heffernan, Hanna Jankowski, Kevin McGregor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
